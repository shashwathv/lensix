#!/usr/bin/env bash

# Lensix Launcher Script
# This script finds the installation directory and runs search.py with the virtual environment

# --- Find the real directory of this script (following symlinks) ---
SOURCE=${BASH_SOURCE[0]}
while [ -L "$SOURCE" ]; do
  DIR=$( cd -P "$( dirname "$SOURCE" )" >/dev/null 2>&1 && pwd )
  SOURCE=$(readlink "$SOURCE")
  [[ $SOURCE != /* ]] && SOURCE=$DIR/$SOURCE
done
SCRIPT_DIR=$( cd -P "$( dirname "$SOURCE" )" >/dev/null 2>&1 && pwd )

# --- Define paths ---
VENV_PYTHON="${SCRIPT_DIR}/.venv/bin/python3"
SEARCH_SCRIPT="${SCRIPT_DIR}/search.py"

# --- Validation ---
if [ ! -f "$VENV_PYTHON" ]; then
    echo "❌ Error: Python virtual environment not found."
    echo ""
    echo "Expected location: $VENV_PYTHON"
    echo ""
    echo "The installation may be incomplete or corrupted."
    echo "Please run the installer again:"
    echo "  cd $SCRIPT_DIR && ./scripts/install.sh"
    exit 1
fi

if [ ! -f "$SEARCH_SCRIPT" ]; then
    echo "❌ Error: search.py not found."
    echo ""
    echo "Expected location: $SEARCH_SCRIPT"
    echo ""
    echo "The installation may be incomplete."
    exit 1
fi

# --- Run the application ---
exec "$VENV_PYTHON" "$SEARCH_SCRIPT" "$@"